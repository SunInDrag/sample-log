document.addEventListener("DOMContentLoaded",function(){typeof mermaid!="undefined"&&mermaid.initialize({startOnLoad:!1,theme:"dark",securityLevel:"loose",fontFamily:"JetBrains Mono, Consolas, Monaco, monospace"}),enhanceCodeBlocks(),fixPythonIndentation(),addScrollIndicators(),enhancePlainCodeBlocks(),renderMermaidDiagrams()});function enhancePlainCodeBlocks(){const e=document.querySelectorAll("pre:not(.line-numbers-pre):not(.code-content)");e.forEach(e=>{if(e.classList.contains("enhanced"))return;if(e.scrollWidth>e.clientWidth&&e.classList.add("scrollable"),e.addEventListener("scroll",function(){this.scrollLeft>0?this.classList.add("scrolled"):this.classList.remove("scrolled")}),!e.querySelector(".copy-button")){const t=document.createElement("button");t.className="copy-button",t.title="复制代码",t.innerHTML='<i class="fas fa-copy"></i>',t.addEventListener("click",function(){const t=e.textContent;navigator.clipboard.writeText(t).then(()=>{this.innerHTML='<i class="fas fa-check"></i>',this.classList.add("copied"),setTimeout(()=>{this.innerHTML='<i class="fas fa-copy"></i>',this.classList.remove("copied")},2e3)}).catch(e=>{console.error("复制失败:",e)})}),e.appendChild(t)}e.classList.add("enhanced")})}function enhanceCodeBlocks(){const e=document.querySelectorAll("figure.highlight");e.forEach(e=>{const m=Array.from(e.classList).find(e=>e!=="highlight"),a=m?m.replace("language-",""):"code",h=e.querySelector("table");if(!h)return;const g=h.querySelector(".gutter pre"),p=g?Array.from(g.querySelectorAll(".line")).map(e=>e.textContent):[],f=h.querySelector(".code pre code"),y=f?f.innerHTML:"",l=document.createElement("div");l.className="code-block-container";const o=document.createElement("div");o.className="code-header";const u=document.createElement("div");u.className="code-header-left";const d=document.createElement("div");d.className="code-header-right";const i=document.createElement("button");i.className="code-header-button toggle-btn",i.title="折叠/展开代码块",i.innerHTML='<i class="fas fa-chevron-down"></i>',d.appendChild(i);const s=document.createElement("button");s.className="copy-btn",s.title="复制代码",s.innerHTML='<i class="fas fa-copy"></i>';const c=document.createElement("span");c.className=`code-language language-${a.toLowerCase()}`,c.textContent=a,a==="code"&&c.classList.add("language-default"),u.appendChild(c),o.appendChild(u),o.appendChild(d);const r=document.createElement("pre");r.className="line-numbers-pre",p.forEach(e=>{const t=document.createElement("div");t.className="line-num",t.textContent=e,r.appendChild(t)});const n=document.createElement("pre");n.className=`code-content hljs ${a}`,n.innerHTML=y;const t=document.createElement("div");t.className="code-pre-wrapper",t.appendChild(r),t.appendChild(n),t.appendChild(s);const v=p.length;v<4&&(t.classList.add("few-lines"),t.classList.add(`line-count-${v}`)),l.appendChild(o),l.appendChild(t);const b=e.parentNode;b.insertBefore(l,e),b.removeChild(e),n.scrollWidth>n.clientWidth&&t.classList.add("scrollable"),n.addEventListener("scroll",function(){r.scrollTop=this.scrollTop});const j=o.querySelector(".toggle-btn");j&&j.addEventListener("click",function(){t.classList.toggle("collapsed");const e=this.querySelector("i");t.classList.contains("collapsed")?e.className="fas fa-chevron-right":e.className="fas fa-chevron-down"}),s.addEventListener("click",function(){const e=n.textContent;navigator.clipboard.writeText(e).then(()=>{this.innerHTML='<i class="fas fa-check"></i>',this.classList.add("copied"),setTimeout(()=>{this.innerHTML='<i class="fas fa-copy"></i>',this.classList.remove("copied")},2e3)}).catch(e=>{console.error("无法复制代码:",e)})})})}function addCopyButtons(){const e=document.querySelectorAll("figure.highlight");e.forEach(e=>{if(!e.querySelector(".copy-btn")){const t=document.createElement("button");t.className="copy-btn",t.innerHTML='<i class="fas fa-copy"></i>',t.title="复制",t.addEventListener("click",function(){const n=e.querySelector("code").textContent;navigator.clipboard.writeText(n).then(()=>{t.innerHTML='<i class="fas fa-check"></i>',t.classList.add("copied"),setTimeout(()=>{t.innerHTML='<i class="fas fa-copy"></i>',t.classList.remove("copied")},2e3)})}),e.appendChild(t)}})}function fixPythonIndentation(){const e=document.querySelectorAll(".language-python code, .python code");e.forEach(e=>{e.style.fontFamily="'JetBrains Mono', 'Consolas', monospace",e.style.tabSize="4",e.style.MozTabSize="4",e.style.OTabSize="4",e.style.whiteSpace="pre"})}function addScrollIndicators(){const e=document.querySelectorAll("figure.highlight");e.forEach(e=>{const t=()=>{e.scrollWidth>e.clientWidth?e.classList.add("scrollable"):e.classList.remove("scrollable")};t(),window.addEventListener("resize",t),e.addEventListener("scroll",function(){this.scrollLeft>0?this.classList.add("scrolled"):this.classList.remove("scrolled")})})}function renderMermaidDiagrams(){if(typeof mermaid=="undefined"){console.warn("Mermaid library not loaded");return}const e=document.querySelectorAll("pre.mermaid");if(e.length===0)return;e.forEach((e,t)=>{const o=e.previousElementSibling;if(!o)return;if(o.classList.contains("mermaid-processed"))return;const s=e.textContent;if(!s.trim())return;const n=document.createElement("div");n.className="mermaid-diagram",n.style.textAlign="center",n.style.margin="20px 0",n.style.cursor="pointer";const i=`mermaid-diagram-${t}`;n.id=i,n.textContent=s;const a=o.parentElement;if(a)try{mermaid.render(i,s).then(t=>{e.innerHTML="",n.innerHTML=t.svg,e.appendChild(n),n.addEventListener("click",function(){enlargeDiagram(this)})}).catch(e=>{console.error("Mermaid rendering error:",e),n.innerHTML=`<pre><code class="mermaid">${s}</code></pre>`,n.classList.add("mermaid-error")})}catch(e){console.error("Mermaid rendering error:",e),n.innerHTML=`<pre><code class="mermaid">${s}</code></pre>`,n.classList.add("mermaid-error")}o.classList.add("mermaid-processed")})}function enlargeDiagram(e){const t=document.createElement("div");t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.width="100%",t.style.height="100%",t.style.backgroundColor="rgba(0,0,0,0.8)",t.style.display="flex",t.style.justifyContent="center",t.style.alignItems="center",t.style.zIndex="1000";const n=e.cloneNode(!0);n.style.width="auto",n.style.height="auto",n.style.objectFit="contain",n.style.transition="all 0.3s ease",n.style.cursor="zoom-out",t.appendChild(n);const s=()=>{const e=n.offsetWidth/n.offsetHeight,t=window.innerWidth/window.innerHeight;console.log(n.firstChild.style.maxWidth),n.firstChild.style.maxWidth?(n.firstChild.style.width="95vw",n.firstChild.style.height="auto"):(n.firstChild.style.width="auto",n.firstChild.style.height="95vh")};s(),window.addEventListener("resize",s),t.addEventListener("click",function(){document.body.removeChild(t),window.removeEventListener("resize",s)}),document.body.appendChild(t)}